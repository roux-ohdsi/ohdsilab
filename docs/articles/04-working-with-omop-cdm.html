<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with Data from the ohdsilab database • ohdsilab</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Working with Data from the ohdsilab database">
<meta property="og:description" content="ohdsilab">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ohdsilab</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01-intro-to-ohdsilab.html">Introduction to ohdsilab</a>
    </li>
    <li>
      <a href="../articles/02-Generating-a-cohort.html">Generating a cohort</a>
    </li>
    <li>
      <a href="../articles/03-feature-extraction-covariates.html">Generating Covariates and Table 1</a>
    </li>
    <li>
      <a href="../articles/04-working-with-omop-cdm.html">Working with Data from the ohdsilab database</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Working with Data from the ohdsilab
database</h1>
            
      
      
      <div class="hidden name"><code>04-working-with-omop-cdm.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://roux-ohdsi.github.io/ohdsilab/" class="external-link">ohdsilab</a></span><span class="op">)</span></span></code></pre></div>
<p>The code in this vignette will provide a brief example of working
with data in the ohdsilab database. The goal is to estimate outpatient
speech-language pathology treatment utilization for individuals with
post-stroke aphasia (aphasia is a disorder of <em>language</em> that
most typically occurs after left-hemisphere stroke and has a profound
impact on communication as well as overall quality of life. there are
about 2.5 million people currently in the U.S. with aphasia)</p>
<p>Start by setting the credientials, like previous vignettes. I’m also
setting the defaults for the connection so that I can use the
<code><a href="../reference/omop_join.html">omop_join()</a></code> and other similar functions from the ohdsilab
package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usr</span> <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">"lab_user"</span><span class="op">)</span></span>
<span><span class="va">pw</span>  <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">"lab_password"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># DB Connections</span></span>
<span></span>
<span><span class="va">base_url</span> <span class="op">=</span> <span class="st">"https://atlas.roux-ohdsi-prod.aws.northeastern.edu/WebAPI"</span></span>
<span><span class="va">cdm_schema</span> <span class="op">=</span> <span class="st">"omop_cdm_53_pmtx_202203"</span></span>
<span><span class="va">my_schema</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"work_"</span>, <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">"lab_user"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the connection</span></span>
<span><span class="va">con</span> <span class="op">=</span>  <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/connect.html" class="external-link">connect</a></span><span class="op">(</span>dbms <span class="op">=</span> <span class="st">"redshift"</span>,</span>
<span>                                  server <span class="op">=</span> <span class="st">"ohdsi-lab-redshift-cluster-prod.clsyktjhufn7.us-east-1.redshift.amazonaws.com/ohdsi_lab"</span>,</span>
<span>                                  port <span class="op">=</span> <span class="fl">5439</span>,</span>
<span>                                  user <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">"lab_user"</span><span class="op">)</span>,</span>
<span>                                  password <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">"lab_password"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>con.default.value <span class="op">=</span> <span class="va">con</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>schema.default.value <span class="op">=</span> <span class="va">cdm_schema</span><span class="op">)</span></span></code></pre></div>
<p>We’ll use a cohort generated in ATLAS, #860: [RC] CVA Ischemic or
Hemorrhagic with admission. This is a cohort based on the phenotype
library defintion for stroke with inpatient admission. The cohort
requires a lookback of 180 days without a similar event and 365 days of
continuous observation after the index date. There is also a cohort exit
date of 365 days past the index date - I’m not interested in events past
365 days and this will be helpful for filtering the data later.</p>
<p>We could also add a concept set for aphasia in ATLAS and use this
concept set to define the cohort, but I was (at the time) thinking about
calculating utilization for stroke survivors without aphasia as well, so
the cohort definition is relatively simple and includes stroke survivors
with and without aphasia. This returns a SQL query (not a dataframe
yet!), but I’m going to go ahead and select the columns that I want. I
also had named the patient ID column “subject_id” in CohortGenerator and
I need to fix that so it matches the rest of the OMOP data. (Next time I
will call it person_id from the get go).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get cohort that has an entry date prior to 2018</span></span>
<span><span class="va">cohort</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">con</span>, <span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/inDatabaseSchema.html" class="external-link">inDatabaseSchema</a></span><span class="op">(</span><span class="va">my_schema</span>, <span class="st">"rc_aphasia"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>person_id <span class="op">=</span> <span class="va">subject_id</span>, <span class="va">cohort_start_date</span>, <span class="va">cohort_end_date</span><span class="op">)</span></span></code></pre></div>
<p>Now I need concepts that are used for aphasia. There are actually
quite a few of them, and I’ve already gone ahead and used ATHENA to
limit the codes to just the ones I really care about. Based on ATLAS
though, 2-3 of these codes make up the vast majority of those present in
pharmetrics.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aphasia_concepts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4049150</span>,<span class="fl">4312097</span>,<span class="fl">4320483</span>,<span class="fl">763039</span>,<span class="fl">4299183</span>,<span class="fl">46272980</span>,<span class="fl">440084</span>,</span>
<span>                    <span class="fl">4012864</span>,<span class="fl">4215589</span>,<span class="fl">4217159</span>,<span class="fl">4031157</span>,<span class="fl">4256743</span>,<span class="fl">40484101</span>,<span class="fl">42535427</span>,</span>
<span>                    <span class="fl">4240405</span>,<span class="fl">4063072</span>,<span class="fl">4082040</span>,<span class="fl">4252416</span>,<span class="fl">4146672</span>,<span class="fl">4046084</span>,<span class="fl">4047125</span>,</span>
<span>                    <span class="fl">4131821</span>,<span class="fl">42535429</span>,<span class="fl">3181357</span>,<span class="fl">37396532</span>,<span class="fl">440424</span>,<span class="fl">4043379</span>,<span class="fl">4062431</span>,</span>
<span>                    <span class="fl">40480002</span>,<span class="fl">4147666</span>,<span class="fl">4304820</span>,<span class="fl">4225746</span>,<span class="fl">4269227</span>,<span class="fl">4044923</span>,<span class="fl">4060092</span>,</span>
<span>                    <span class="fl">35621734</span>,<span class="fl">4245018</span>,<span class="fl">4278687</span>,<span class="fl">4184473</span>,<span class="fl">35610281</span>,<span class="fl">765610</span>,<span class="fl">4327962</span>,</span>
<span>                    <span class="fl">36685003</span>,<span class="fl">4046219</span>,<span class="fl">36685012</span>,<span class="fl">4185285</span>,<span class="fl">4084825</span>,<span class="fl">4173098</span>,<span class="fl">4077061</span>,</span>
<span>                    <span class="fl">4036512</span>,<span class="fl">4287230</span>,<span class="fl">4232189</span>,<span class="fl">4045421</span>,<span class="fl">4232482</span>,<span class="fl">4207412</span>,<span class="fl">37396465</span>,</span>
<span>                    <span class="fl">4203167</span>,<span class="fl">4263333</span>,<span class="fl">4287839</span>,<span class="fl">4148072</span><span class="op">)</span></span></code></pre></div>
<p>And I’m going to use these concept IDs to filter the concept table to
get the human readable concept name. We’ll save this table for use
later.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">concepts</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">con</span>, <span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/inDatabaseSchema.html" class="external-link">inDatabaseSchema</a></span><span class="op">(</span><span class="va">cdm_schema</span>, <span class="st">"concept"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">concept_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="op">!</span><span class="op">!</span><span class="va">aphasia_concepts</span><span class="op">)</span></span></code></pre></div>
<p>Next, I’m going to use my cohort table to limit the data from the
condition occurrence table to just rows for the individuals AND
timeframe that I care about. This code chunk first joins the cohort
table with the fixed person_id column name (from above) to the condition
occurrence table, which holds instances of the conditions tagged to
people in the data set. Second, it filteres for only the conditions that
occured within the timeframe of interest (within 365 days of the index
date). Third, it joins the concepts table from above to get human
readable concept names on the conditions that were found. Finally, I
select only the columns I’m interested in.</p>
<p>We can use the <code><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">tally()</a></code> function to check how many rows
would be returned by the query (this can take a hot second). If its not
too many rows for my local system (and this one isn’t) , we can go ahead
and “collect” the data, which means bringing it into our local R
session. The number of rows you can collect will vary based on your
computer’s RAM/CPU but I wouldn’t recommend trying to collect more than
1,000,000 rows generally if you can help it.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cond</span> <span class="op">=</span> <span class="va">cohort</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/omop_join.html">omop_join</a></span><span class="op">(</span><span class="st">"condition_occurrence"</span>, type <span class="op">=</span> <span class="st">"inner"</span>, by <span class="op">=</span> <span class="st">"person_id"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">condition_start_date</span> <span class="op">&gt;</span> <span class="va">cohort_start_date</span> <span class="op">&amp;</span> <span class="va">condition_start_date</span> <span class="op">&lt;</span> <span class="va">cohort_end_date</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">concepts</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"condition_concept_id"</span> <span class="op">=</span> <span class="st">"concept_id"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">person_id</span>, <span class="va">cohort_start_date</span>, <span class="va">cohort_end_date</span>, <span class="va">condition_concept_id</span>,</span>
<span>         <span class="va">condition_start_date</span>, <span class="va">provider_id</span>, <span class="va">visit_occurrence_id</span>, <span class="va">visit_detail_id</span>,</span>
<span>         <span class="va">condition_source_value</span>, <span class="va">condition_source_concept_id</span>, <span class="va">concept_name</span>, <span class="va">domain_id</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">tally</a></span><span class="op">(</span><span class="va">cond</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cond</span> <span class="op">=</span> <span class="va">cond</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/dbi_collect.html">dbi_collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>I decided that I wanted there to be two separate occurances of the
aphasia code present to increase the odds that I really want identifying
people with aphasia. I don’t necessarily trust that the Dx codes are
used accurately, so having two separate occurrences increases seems
safer. Perhaps the risk is that I will tend to get a more severe cohort,
but I’m ok with that risk for now. Here, I’m using the count function to
count condition occurrences of aphasia and then only keeping the
person_id’s that have more than one. This one-column query will hold my
final cohort of interest.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pwa_table</span> <span class="op">=</span> <span class="va">cohort</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/omop_join.html">omop_join</a></span><span class="op">(</span><span class="st">"condition_occurrence"</span>, type <span class="op">=</span> <span class="st">"inner"</span>, by <span class="op">=</span> <span class="st">"person_id"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">condition_start_date</span> <span class="op">&gt;</span> <span class="va">cohort_start_date</span> <span class="op">&amp;</span> <span class="va">condition_start_date</span> <span class="op">&lt;</span> <span class="va">cohort_end_date</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">concepts</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"condition_concept_id"</span> <span class="op">=</span> <span class="st">"concept_id"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">person_id</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">person_id</span><span class="op">)</span></span></code></pre></div>
<p>For this cohort, I’m interested in how many outpatient treatment
sessions they receive within the first year post stroke. Since I have
some domain expertise here, it was easy for me to look up the CPT codes
associated with these procedures in ATHENA and get their omop concept
IDs. I also looked at the concept names for the facility types that I’m
interested in, and I’ll use these to limit to visits that are just in
outpatient settings.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slp_tx</span> <span class="op">=</span> <span class="fl">2313701</span></span>
<span><span class="va">slp_eval</span> <span class="op">=</span> <span class="fl">44816446</span></span>
<span><span class="va">aphasia_eval</span> <span class="op">=</span> <span class="fl">2314188</span></span>
<span><span class="va">old_eval</span> <span class="op">=</span> <span class="fl">2313700</span></span>
<span></span>
<span><span class="va">OP</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Outpatient Hospital"</span>, <span class="st">"Office Visit"</span>, <span class="st">"Comprehensive Outpatient Rehabilitation Facility"</span>, <span class="st">"Outpatient Visit"</span>, <span class="st">"Independent Clinic"</span><span class="op">)</span>                      </span></code></pre></div>
<p>Starting with the pwa_table (which is just one column of the unique
person_id’s that I’m interested in), we can join to get only procedures
for these individuals, then further filter for the evaluation and
treatment procedure codes that we care about. After filtering, just the
relevant columns are selected. Then, I joined these procedures to the
visit occurences and concept table to get more information about where
these procedures were done. Finally, I collected the data. I did some
other things not noted here, like join with the payer_plan_period to get
data on what types of insurers these individuals had. I could also join
with the cost table if I wanted information about the cost of SLP
services within 1 year post stroke.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pwa_visits</span> <span class="op">&lt;-</span> <span class="va">pwa_table</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/omop_join.html">omop_join</a></span><span class="op">(</span><span class="st">"procedure_occurrence"</span>, type <span class="op">=</span> <span class="st">"left"</span>, by <span class="op">=</span> <span class="st">"person_id"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">procedure_concept_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">slp_tx</span>, <span class="va">slp_eval</span>, <span class="va">aphasia_eval</span>, <span class="va">old_eval</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">person_id</span>, <span class="va">procedure_concept_id</span>, <span class="va">procedure_date</span>, <span class="va">visit_occurrence_id</span>, <span class="va">visit_detail_id</span>, <span class="va">procedure_source_value</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/omop_join.html">omop_join</a></span><span class="op">(</span><span class="st">"visit_occurrence"</span>, type <span class="op">=</span> <span class="st">"left"</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"visit_occurrence_id"</span>, <span class="st">"person_id"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/omop_join.html">omop_join</a></span><span class="op">(</span><span class="st">"concept"</span>, type <span class="op">=</span> <span class="st">"inner"</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"visit_concept_id"</span> <span class="op">=</span> <span class="st">"concept_id"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">cohort</span>, by <span class="op">=</span> <span class="st">"person_id"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/dbi_collect.html">dbi_collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>There was quite a bit of wrangling that occurred after this to
synthesize the visits within episodes of care and incorporate
information about facilities to define episodes of care that I’ll leave
out - but all of that wrangling was done locally (so not on the database
end) - just like you would for any normal dataset you read into R.</p>
<p>Hopefully this was a helpful example to see how you can combine
information across the different OMOP tables to filter and drill down to
exactly the data you’re interested in. exactly the data you’re
interested in</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Louisa Smith, Rob Cavanaugh.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
