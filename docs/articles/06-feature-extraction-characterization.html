<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Generating Characterization Files • ohdsilab</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Generating Characterization Files">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-black" data-bs-theme="dark" aria-label="Site navigation"><div class="container">
    <div style="height:40px;display:inline;margin:0 10px;"><a href="https://ohdsi.northeastern.edu/" class="external-link"><img src="logo.png" style="width:auto;height:100%;"></a></div>
    <a class="navbar-brand me-2" href="../index.html">ohdsilab</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/01-intro-to-ohdsilab.html">Introduction to ohdsilab (start here!)</a></li>
    <li><a class="dropdown-item" href="../articles/02-getting-started-with-box.html">Getting Started with the OHDSI-Lab Box</a></li>
    <li><a class="dropdown-item" href="../articles/03-Generating-a-cohort.html">Generating a cohort</a></li>
    <li><a class="dropdown-item" href="../articles/04-Generating-a-cohort-with_Capr.html">Generating a cohort with Capr</a></li>
    <li><a class="dropdown-item" href="../articles/05-feature-extraction-covariates.html">Generating Covariates and Table 1</a></li>
    <li><a class="dropdown-item" href="../articles/06-feature-extraction-characterization.html">Generating Characterization Files</a></li>
    <li><a class="dropdown-item" href="../articles/07-working-with-omop-cdm.html">Working with Data from the ohdsilab database</a></li>
    <li><a class="dropdown-item" href="../articles/08-CohortExplorer.html">Visualizing Sample Data</a></li>
    <li><a class="dropdown-item" href="../articles/09-PatientLevelPrediction.html">Patient Level Prediction</a></li>
    <li><a class="dropdown-item" href="../articles/10-CohortMethod.html">Population Level Estimation using CohortMethod</a></li>
    <li><a class="dropdown-item" href="../articles/11-SelfControlledCaseSeries.html">Population Level Estimation using SelfControlledCaseSeries</a></li>
    <li><a class="dropdown-item" href="../articles/12-Eunomia.html">Generating a Synthetic Dataset</a></li>
    <li><a class="dropdown-item" href="../articles/13-Stategus.html">Designing a network analysis using Strategus</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/roux-ohdsi/ohdsilab/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Generating Characterization Files</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/roux-ohdsi/ohdsilab/blob/HEAD/vignettes/06-feature-extraction-characterization.Rmd" class="external-link"><code>vignettes/06-feature-extraction-characterization.Rmd</code></a></small>
      <div class="d-none name"><code>06-feature-extraction-characterization.Rmd</code></div>
    </div>

    
    
<p>This vignette summarizes the code that can be found here: <a href="https://ohdsi.github.io/Characterization/" class="external-link uri">https://ohdsi.github.io/Characterization/</a> and
illustrates how this code can be used within the OHDSI Lab against OHDSI
Lab data.</p>
<p>Install one new package (Characterization) and load it along with the
other typical packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">renv</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/renv/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"OHDSI/Characterization"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://roux-ohdsi.github.io/ohdsilab/">ohdsilab</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/DatabaseConnector/" class="external-link">DatabaseConnector</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://keyring.r-lib.org/" class="external-link">keyring</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/ROhdsiWebApi/" class="external-link">ROhdsiWebApi</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/CohortGenerator/" class="external-link">CohortGenerator</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/OHDSI/FeatureExtraction" class="external-link">FeatureExtraction</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/Characterization/" class="external-link">Characterization</a></span><span class="op">)</span></span></code></pre></div>
<p>Set the connection details. I connect to the database here so I can
set the option(con.default.value) setting in the next line.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span><span class="st">"DATABASECONNECTOR_JAR_FOLDER"</span> <span class="op">=</span> <span class="st">"insert path to JDBC driver"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/createConnectionDetails.html" class="external-link">createConnectionDetails</a></span><span class="op">(</span></span>
<span>    dbms <span class="op">=</span> <span class="st">"redshift"</span>,</span>
<span>    server <span class="op">=</span> <span class="st">"ohdsi-lab-redshift-cluster-prod.clsyktjhufn7.us-east-1.redshift.amazonaws.com/ohdsi_lab"</span>,</span>
<span>    port <span class="op">=</span> <span class="fl">5439</span>,</span>
<span>    user <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">"db_username"</span><span class="op">)</span>,</span>
<span>    password <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">"db_password"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">atlas_url</span> <span class="op">=</span> <span class="st">"https://atlas.roux-ohdsi-prod.aws.northeastern.edu/WebAPI"</span></span>
<span><span class="va">synpuf_schema</span> <span class="op">=</span> <span class="st">"omop_cdm_synpuf_110k_531"</span></span>
<span><span class="va">write_schema</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"work_"</span>, <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">"db_username"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">con</span> <span class="op">=</span>  <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/connect.html" class="external-link">connect</a></span><span class="op">(</span><span class="va">connectionDetails</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>con.default.value <span class="op">=</span> <span class="va">con</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>schema.default.value <span class="op">=</span> <span class="va">synpuf_schema</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>write_schema.default.value <span class="op">=</span> <span class="va">write_schema</span><span class="op">)</span></span></code></pre></div>
<p>Connect to ATLAS</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ROhdsiWebApi</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/ROhdsiWebApi/reference/authorizeWebApi.html" class="external-link">authorizeWebApi</a></span><span class="op">(</span></span>
<span>    <span class="va">atlas_url</span>,</span>
<span>    authMethod <span class="op">=</span> <span class="st">"db"</span>,</span>
<span>    webApiUsername <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">"atlas_username"</span><span class="op">)</span>,</span>
<span>    webApiPassword <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">"atlas_password"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Instead of setting one cohort Id, this time you’re setting a target
cohort Id and an outcome id as the purpose of the characterization
package is to compare a target cohort with an outcome cohort.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">targetId</span> <span class="op">&lt;-</span> <span class="fl">4675</span></span>
<span><span class="va">outcomeId</span> <span class="op">&lt;-</span> <span class="fl">4681</span></span></code></pre></div>
<p>Pull the cohorts definitions from ATLAS, and use them to populate
tables in your write_schema (this code comes from the “Generating a
cohort” vignette)</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cohortDefinitionSet</span> <span class="op">&lt;-</span> <span class="fu">ROhdsiWebApi</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/ROhdsiWebApi/reference/exportCohortDefinitionSet.html" class="external-link">exportCohortDefinitionSet</a></span><span class="op">(</span></span>
<span>    baseUrl <span class="op">=</span> <span class="va">atlas_url</span>,</span>
<span>    cohortIds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">targetId</span>, <span class="va">outcomeId</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">cohortTableNames</span> <span class="op">&lt;-</span> <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortGenerator/reference/getCohortTableNames.html" class="external-link">getCohortTableNames</a></span><span class="op">(</span></span>
<span>    cohortTable <span class="op">=</span> <span class="st">"cohort"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ohdsi.github.io/CohortGenerator/reference/createCohortTables.html" class="external-link">createCohortTables</a></span><span class="op">(</span></span>
<span>    connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,</span>
<span>    cohortTableNames <span class="op">=</span> <span class="va">cohortTableNames</span>,</span>
<span>    cohortDatabaseSchema <span class="op">=</span> <span class="va">write_schema</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">cohortsGenerated</span> <span class="op">&lt;-</span> <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortGenerator/reference/generateCohortSet.html" class="external-link">generateCohortSet</a></span><span class="op">(</span></span>
<span>    connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,</span>
<span>    cdmDatabaseSchema <span class="op">=</span> <span class="va">synpuf_schema</span>,</span>
<span>    cohortDatabaseSchema <span class="op">=</span> <span class="va">write_schema</span>,</span>
<span>    cohortTableNames <span class="op">=</span> <span class="va">cohortTableNames</span>,</span>
<span>    cohortDefinitionSet <span class="op">=</span> <span class="va">cohortDefinitionSet</span><span class="op">)</span></span></code></pre></div>
<p>Now, set the covariate settings. The createCovariateSettings()
function can be used to customize the output of characterization. Run
?createCovariateSettings to view all possible arguments. For now, we’ll
just use createDefaultCovariateSettings() as we don’t need anything
specific. The aggreegateCovariate Settings will be used as an argument
when we set the characterization settings. Other argument options for
characterization are timeToEventSettings and
dechallengeRechallengeSettings.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aggregateCovariateSettings</span> <span class="op">&lt;-</span> <span class="fu">Characterization</span><span class="fu">::</span><span class="fu">createAggregateCovariateSettings</span><span class="op">(</span></span>
<span>  targetIds <span class="op">=</span> <span class="va">targetId</span>,</span>
<span>  outcomeIds <span class="op">=</span> <span class="va">outcomeId</span>,</span>
<span>  riskWindowStart <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  startAnchor <span class="op">=</span> <span class="st">'cohort start'</span>,</span>
<span>  riskWindowEnd <span class="op">=</span> <span class="fl">365</span>,</span>
<span>  endAnchor <span class="op">=</span> <span class="st">'cohort start'</span>,</span>
<span>  covariateSettings <span class="op">=</span> <span class="fu">FeatureExtraction</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/FeatureExtraction/man/createDefaultCovariateSettings.html" class="external-link">createDefaultCovariateSettings</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Set the characterization settings</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">characterizationSettings</span> <span class="op">&lt;-</span> <span class="fu">Characterization</span><span class="fu">::</span><span class="fu">createCharacterizationSettings</span><span class="op">(</span></span>
<span>  aggregateCovariateSettings <span class="op">=</span> <span class="va">aggregateCovariateSettings</span><span class="op">)</span></span></code></pre></div>
<p>Run the characterization. This will generate a series of csv files
that can later be analyzed using traditional or programmatic methods.
You may want to create a folder before running the following code and
set the path of outputDirectory and executionPath to that folder.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">Characterization</span><span class="fu">::</span><span class="fu">runCharacterizationAnalyses</span><span class="op">(</span></span>
<span>  connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,</span>
<span>  cdmDatabaseSchema <span class="op">=</span> <span class="va">synpuf_schema</span>,</span>
<span>  targetDatabaseSchema <span class="op">=</span> <span class="va">write_schema</span>,</span>
<span>  targetTable <span class="op">=</span> <span class="st">'cohort'</span>,</span>
<span>  outcomeDatabaseSchema <span class="op">=</span> <span class="va">write_schema</span>,</span>
<span>  outcomeTable <span class="op">=</span> <span class="st">'cohort'</span>,</span>
<span>  characterizationSettings <span class="op">=</span> <span class="va">characterizationSettings</span>,   </span>
<span>  outputDirectory <span class="op">=</span> <span class="st">"insert path to output folder"</span>,</span>
<span>  executionPath <span class="op">=</span> <span class="st">"insert path to output folder"</span>,</span>
<span>  csvFilePrefix <span class="op">=</span> <span class="st">'insert custom prefix'</span><span class="op">)</span></span></code></pre></div>
<p>And that’s it! The characterization files may take a while to
generate depending on the size of your cohorts and the amount of
variables you include in your characterization settings.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Louisa Smith, Rob Cavanaugh.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
