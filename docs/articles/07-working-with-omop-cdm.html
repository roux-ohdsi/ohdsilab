<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Working with Data from the ohdsilab database • ohdsilab</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Working with Data from the ohdsilab database">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-black" data-bs-theme="dark" aria-label="Site navigation"><div class="container">
    <div style="height:40px;display:inline;margin:0 10px;"><a href="https://ohdsi.northeastern.edu/" class="external-link"><img src="logo.png" style="width:auto;height:100%;"></a></div>
    <a class="navbar-brand me-2" href="../index.html">ohdsilab</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/01-intro-to-ohdsilab.html">Introduction to ohdsilab (start here!)</a></li>
    <li><a class="dropdown-item" href="../articles/02-getting-started-with-box.html">Getting Started with the OHDSI-Lab Box</a></li>
    <li><a class="dropdown-item" href="../articles/03-Generating-a-cohort.html">Generating a cohort</a></li>
    <li><a class="dropdown-item" href="../articles/04-Generating-a-cohort-with_Capr.html">Generating a cohort with Capr</a></li>
    <li><a class="dropdown-item" href="../articles/05-feature-extraction-covariates.html">Generating Covariates and Table 1</a></li>
    <li><a class="dropdown-item" href="../articles/06-feature-extraction-characterization.html">Generating Characterization Files</a></li>
    <li><a class="dropdown-item" href="../articles/07-working-with-omop-cdm.html">Working with Data from the ohdsilab database</a></li>
    <li><a class="dropdown-item" href="../articles/08-CohortExplorer.html">Visualizing Sample Data</a></li>
    <li><a class="dropdown-item" href="../articles/09-PatientLevelPrediction.html">Patient Level Prediction</a></li>
    <li><a class="dropdown-item" href="../articles/10-Eunomia.html">Generating a Synthetic Dataset</a></li>
    <li><a class="dropdown-item" href="../articles/11-Stategus.html">Designing a network analysis using Strategus</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/roux-ohdsi/ohdsilab/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Working with Data from the ohdsilab database</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/roux-ohdsi/ohdsilab/blob/HEAD/vignettes/07-working-with-omop-cdm.Rmd" class="external-link"><code>vignettes/07-working-with-omop-cdm.Rmd</code></a></small>
      <div class="d-none name"><code>07-working-with-omop-cdm.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://roux-ohdsi.github.io/ohdsilab/">ohdsilab</a></span><span class="op">)</span></span></code></pre></div>
<p>The code in this vignette will provide a brief example of working
with data in the ohdsilab database. It provides a brief clinical context
and explanation for what each chunk of code does and why.</p>
<p>The goal of the analysis is to estimate outpatient speech-language
pathology treatment utilization for individuals with post-stroke aphasia
in the first year after stroke. Aphasia is a <em>language</em> disorder
that most typically occurs after left-hemisphere stroke and has a
profound impact on communication as well as overall quality of life.
There are about 2.5 million people currently in the U.S. with
aphasia.</p>
<p>Start by setting the credientials and default schemas.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># DB Connections</span></span>
<span><span class="va">atlas_url</span> <span class="op">=</span> <span class="st">"https://atlas.roux-ohdsi-prod.aws.northeastern.edu/WebAPI"</span></span>
<span><span class="va">cdm_schema</span> <span class="op">=</span> <span class="st">"omop_cdm_53_pmtx_202203"</span></span>
<span><span class="va">write_schema</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"work_"</span>, <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">"db_username"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span><span class="st">"DATABASECONNECTOR_JAR_FOLDER"</span> <span class="op">=</span> <span class="st">"insert path to jdbc driver here"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the connection (using the shortcut ohdsilab_connect function)</span></span>
<span><span class="va">con</span> <span class="op">=</span>  <span class="fu">ohdsilab</span><span class="fu">::</span><span class="fu"><a href="../reference/ohdsilab_connect.html">ohdsilab_connect</a></span><span class="op">(</span>username <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">"db_username"</span><span class="op">)</span>,</span>
<span>                                  password <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">"db_password"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We’ll use a cohort generated in ATLAS, #860: [RC] CVA Ischemic or
Hemorrhagic with admission. This is a cohort based on the phenotype
library defintion for stroke with inpatient admission. The cohort
requires a look-back of 180 days without a similar event and 365 days of
continuous observation after the index date. There is also a cohort exit
date of 365 days past the index date - We’re not interested in events
past 365 days and this will be helpful for filtering the data later.</p>
<p>We could also add a concept set for aphasia in ATLAS and use this
concept set to define the cohort, but I was (at the time) thinking about
calculating utilization for stroke survivors without aphasia as well, so
the cohort definition is relatively simple and includes stroke survivors
with and without aphasia. This returns a SQL query (not a dataframe
yet!), but I’m going to go ahead and select the columns that I want. I
also had named the patient ID column “subject_id” in CohortGenerator and
I need to fix that so it matches the rest of the OMOP data. (Next time I
will call it person_id from the get go).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get cohort that has an entry date prior to 2018</span></span>
<span><span class="va">cohort</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span></span>
<span>    <span class="va">con</span>,</span>
<span>    <span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/inDatabaseSchema.html" class="external-link">inDatabaseSchema</a></span><span class="op">(</span><span class="va">write_schema</span>, <span class="st">"rc_aphasia"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>person_id <span class="op">=</span> <span class="va">subject_id</span>, <span class="va">cohort_start_date</span>, <span class="va">cohort_end_date</span><span class="op">)</span></span></code></pre></div>
<p>Now I need concepts that are used for aphasia. There are actually
quite a few of them, and I’ve already gone ahead and used ATHENA to
limit the codes to just the ones I really care about. Based on ATLAS
though, 2-3 of these codes make up the vast majority of those present in
pharmetrics.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aphasia_concepts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4049150</span>,<span class="fl">4312097</span>,<span class="fl">4320483</span>,<span class="fl">763039</span>,<span class="fl">4299183</span>,<span class="fl">46272980</span>,<span class="fl">440084</span>,</span>
<span>                    <span class="fl">4012864</span>,<span class="fl">4215589</span>,<span class="fl">4217159</span>,<span class="fl">4031157</span>,<span class="fl">4256743</span>,<span class="fl">40484101</span>,<span class="fl">42535427</span>,</span>
<span>                    <span class="fl">4240405</span>,<span class="fl">4063072</span>,<span class="fl">4082040</span>,<span class="fl">4252416</span>,<span class="fl">4146672</span>,<span class="fl">4046084</span>,<span class="fl">4047125</span>,</span>
<span>                    <span class="fl">4131821</span>,<span class="fl">42535429</span>,<span class="fl">3181357</span>,<span class="fl">37396532</span>,<span class="fl">440424</span>,<span class="fl">4043379</span>,<span class="fl">4062431</span>,</span>
<span>                    <span class="fl">40480002</span>,<span class="fl">4147666</span>,<span class="fl">4304820</span>,<span class="fl">4225746</span>,<span class="fl">4269227</span>,<span class="fl">4044923</span>,<span class="fl">4060092</span>,</span>
<span>                    <span class="fl">35621734</span>,<span class="fl">4245018</span>,<span class="fl">4278687</span>,<span class="fl">4184473</span>,<span class="fl">35610281</span>,<span class="fl">765610</span>,<span class="fl">4327962</span>,</span>
<span>                    <span class="fl">36685003</span>,<span class="fl">4046219</span>,<span class="fl">36685012</span>,<span class="fl">4185285</span>,<span class="fl">4084825</span>,<span class="fl">4173098</span>,<span class="fl">4077061</span>,</span>
<span>                    <span class="fl">4036512</span>,<span class="fl">4287230</span>,<span class="fl">4232189</span>,<span class="fl">4045421</span>,<span class="fl">4232482</span>,<span class="fl">4207412</span>,<span class="fl">37396465</span>,</span>
<span>                    <span class="fl">4203167</span>,<span class="fl">4263333</span>,<span class="fl">4287839</span>,<span class="fl">4148072</span><span class="op">)</span></span></code></pre></div>
<p>And I’m going to use these concept IDs to filter the concept table to
get the human readable concept name. We’ll save this table for use
later.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">concepts</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span></span>
<span>    <span class="va">con</span>,</span>
<span>    <span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/inDatabaseSchema.html" class="external-link">inDatabaseSchema</a></span><span class="op">(</span><span class="va">cdm_schema</span>, <span class="st">"concept"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">concept_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="op">!</span><span class="op">!</span><span class="va">aphasia_concepts</span><span class="op">)</span></span></code></pre></div>
<p>Next, I’m going to use my cohort table to limit the data from the
condition occurrence table to just rows for the individuals AND
timeframe that I care about. This code chunk first joins the cohort
table with the fixed person_id column name (from above) to the condition
occurrence table, which holds instances of the conditions tagged to
people in the data set. Second, it filters for only the conditions that
occured within the timeframe of interest (within 365 days of the index
date). Third, it joins the concepts table from above to get human
readable concept names on the conditions that were found. Finally, I
select only the columns I’m interested in.</p>
<p>We can use the <code><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">tally()</a></code> function to check how many rows
would be returned by the query (this can take a hot second). If its not
too many rows for my local system (and this one isn’t), we can go ahead
and “collect” the data, which means bringing it into our local R
session. The number of rows you can collect will vary based on your
computer’s RAM/CPU but I wouldn’t recommend trying to collect more than
1,000,000 rows generally if you can help it.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cond</span> <span class="op">=</span> <span class="va">cohort</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/omop_join.html">omop_join</a></span><span class="op">(</span><span class="st">"condition_occurrence"</span>, type <span class="op">=</span> <span class="st">"inner"</span>, by <span class="op">=</span> <span class="st">"person_id"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">condition_start_date</span> <span class="op">&gt;</span> <span class="va">cohort_start_date</span> <span class="op">&amp;</span> <span class="va">condition_start_date</span> <span class="op">&lt;</span> <span class="va">cohort_end_date</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">concepts</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"condition_concept_id"</span> <span class="op">=</span> <span class="st">"concept_id"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">person_id</span>, <span class="va">cohort_start_date</span>, <span class="va">cohort_end_date</span>, <span class="va">condition_concept_id</span>,</span>
<span>         <span class="va">condition_start_date</span>, <span class="va">provider_id</span>, <span class="va">visit_occurrence_id</span>, <span class="va">visit_detail_id</span>,</span>
<span>         <span class="va">condition_source_value</span>, <span class="va">condition_source_concept_id</span>, <span class="va">concept_name</span>, <span class="va">domain_id</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">tally</a></span><span class="op">(</span><span class="va">cond</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cond</span> <span class="op">=</span> <span class="va">cond</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/dbi_collect.html">dbi_collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>I decided that I wanted there to be two separate occurances of the
aphasia code present to increase the odds that I really want identifying
people with aphasia. I don’t necessarily trust that the Dx codes are
used accurately, so having two separate occurrences increases seems
safer. Perhaps the risk is that I will tend to get a more severe cohort,
but I’m ok with that risk for now. Here, I’m using the count function to
count condition occurrences of aphasia and then only keeping the
person_id’s that have more than one. This one-column query will hold my
final cohort of interest.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pwa_table</span> <span class="op">=</span> <span class="va">cohort</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/omop_join.html">omop_join</a></span><span class="op">(</span><span class="st">"condition_occurrence"</span>, type <span class="op">=</span> <span class="st">"inner"</span>, by <span class="op">=</span> <span class="st">"person_id"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">condition_start_date</span> <span class="op">&gt;</span> <span class="va">cohort_start_date</span> <span class="op">&amp;</span> <span class="va">condition_start_date</span> <span class="op">&lt;</span> <span class="va">cohort_end_date</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">concepts</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"condition_concept_id"</span> <span class="op">=</span> <span class="st">"concept_id"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">person_id</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">person_id</span><span class="op">)</span></span></code></pre></div>
<p>For this cohort, I’m interested in how many outpatient treatment
sessions they receive within the first year post stroke. Since I have
some domain expertise here, it was easy for me to look up the CPT codes
associated with these procedures in ATHENA and get their omop concept
IDs. I also looked at the concept names for the facility types that I’m
interested in, and I’ll use these to limit to visits that are just in
outpatient settings.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slp_tx</span> <span class="op">=</span> <span class="fl">2313701</span></span>
<span><span class="va">slp_eval</span> <span class="op">=</span> <span class="fl">44816446</span></span>
<span><span class="va">aphasia_eval</span> <span class="op">=</span> <span class="fl">2314188</span></span>
<span><span class="va">old_eval</span> <span class="op">=</span> <span class="fl">2313700</span></span>
<span></span>
<span><span class="va">OP</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Outpatient Hospital"</span>, <span class="st">"Office Visit"</span>, <span class="st">"Comprehensive Outpatient Rehabilitation Facility"</span>, <span class="st">"Outpatient Visit"</span>, <span class="st">"Independent Clinic"</span><span class="op">)</span>                      </span></code></pre></div>
<p>Starting with the pwa_table (which is just one column of the unique
person_id’s that I’m interested in), we can join to get only procedures
for these individuals, then further filter for the evaluation and
treatment procedure codes that we care about. After filtering, just the
relevant columns are selected. Then, I joined these procedures to the
visit occurences and concept table to get more information about where
these procedures were done. Finally, I collected the data. I did some
other things not noted here, like join with the payer_plan_period to get
data on what types of insurers these individuals had. I could also join
with the cost table if I wanted information about the cost of SLP
services within 1 year post stroke.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pwa_visits</span> <span class="op">&lt;-</span> <span class="va">pwa_table</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/omop_join.html">omop_join</a></span><span class="op">(</span><span class="st">"procedure_occurrence"</span>, type <span class="op">=</span> <span class="st">"left"</span>, by <span class="op">=</span> <span class="st">"person_id"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">procedure_concept_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">slp_tx</span>, <span class="va">slp_eval</span>, <span class="va">aphasia_eval</span>, <span class="va">old_eval</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">person_id</span>, <span class="va">procedure_concept_id</span>, <span class="va">procedure_date</span>, <span class="va">visit_occurrence_id</span>, <span class="va">visit_detail_id</span>, <span class="va">procedure_source_value</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/omop_join.html">omop_join</a></span><span class="op">(</span><span class="st">"visit_occurrence"</span>, type <span class="op">=</span> <span class="st">"left"</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"visit_occurrence_id"</span>, <span class="st">"person_id"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/omop_join.html">omop_join</a></span><span class="op">(</span><span class="st">"concept"</span>, type <span class="op">=</span> <span class="st">"inner"</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"visit_concept_id"</span> <span class="op">=</span> <span class="st">"concept_id"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">cohort</span>, by <span class="op">=</span> <span class="st">"person_id"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/dbi_collect.html">dbi_collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>There was quite a bit of wrangling that occurred after this to
synthesize the visits within episodes of care and incorporate
information about facilities to define episodes of care that I’ll leave
out - but all of that wrangling was done locally (so not on the database
end) - just like you would for any normal dataset you read into R.</p>
<p>Hopefully this was a helpful example to see how you can combine
information across the different OMOP tables to filter and drill down to
exactly the data you’re interested in.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Louisa Smith, Rob Cavanaugh.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
